<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Spacebook Â· Messages</title>
<link rel="stylesheet" href="/styles.css"/>
<style>
  body { overflow: hidden; }
  .msg-layout { display: flex; height: calc(100vh - 58px); }
  .conv-list { width: 280px; border-right: 1px solid #333; overflow-y: auto; background: #111; flex-shrink: 0; }
  .conv-list-header { padding: 14px 16px; border-bottom: 1px solid #333; font-weight: 700; color: #ff6a00; display: flex; justify-content: space-between; align-items: center; }
  .conv-item { padding: 12px 14px; cursor: pointer; border-bottom: 1px solid #1a1a1a; display: flex; gap: 10px; align-items: center; transition: background .15s; }
  .conv-item:hover, .conv-item.active { background: #1a1a1a; }
  .conv-avatar { width: 40px; height: 40px; border-radius: 50%; background: #333; border: 2px solid #ff6a00; object-fit: cover; flex-shrink: 0; }
  .conv-name { font-weight: 700; font-size: 14px; }
  .conv-last { font-size: 12px; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px; }
  .online-dot { width: 9px; height: 9px; border-radius: 50%; background: #22c55e; display: inline-block; margin-left: 4px; vertical-align: middle; }
  .chat-panel { flex: 1; display: flex; flex-direction: column; background: #0d0d0d; min-width: 0; }
  .chat-header { padding: 14px 20px; border-bottom: 1px solid #333; background: #111; display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 15px; min-height: 58px; }
  .chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; }
  .msg-bubble { max-width: 60%; padding: 10px 14px; border-radius: 12px; font-size: 14px; line-height: 1.5; position: relative; word-break: break-word; }
  .msg-bubble.mine { background: #ff6a00; color: #000; align-self: flex-end; border-bottom-right-radius: 2px; }
  .msg-bubble.theirs { background: #1a1a1a; border: 1px solid #2a2a2a; color: #f2f2f2; align-self: flex-start; border-bottom-left-radius: 2px; }
  .msg-sender { font-size: 11px; color: #ff6a00; margin-bottom: 2px; font-weight: 700; }
  .msg-time { font-size: 10px; color: #888; margin-top: 3px; }
  .msg-media { max-width: 220px; border-radius: 8px; margin-top: 6px; display: block; }
  .msg-reactions-row { display: flex; gap: 4px; margin-top: 4px; flex-wrap: wrap; }
  .rxn-chip { background: #222; border: 1px solid #333; border-radius: 20px; padding: 2px 8px; font-size: 13px; cursor: pointer; }
  .rxn-chip:hover { border-color: #ff6a00; }
  .react-picker-row { display: none; gap: 6px; margin-top: 4px; }
  .msg-bubble:hover .react-picker-row { display: flex; }
  .typing-bar { min-height: 20px; padding: 2px 20px 4px; font-size: 12px; color: #888; }
  .chat-input-row { padding: 12px 16px; border-top: 1px solid #333; background: #111; display: flex; gap: 8px; align-items: flex-end; }
  .chat-input-row textarea { resize: none; height: 42px; flex: 1; margin-bottom: 0; font-size: 14px; }
  .icon-btn { background: #1a1a1a; border: 1px solid #333; color: #ff6a00; padding: 9px 12px; border-radius: 6px; cursor: pointer; font-size: 18px; flex-shrink: 0; line-height: 1; }
  .icon-btn.recording { background: #ff6a00; color: #000; }
  .sc-preview { background: #1a1a1a; border: 1px solid #ff6a00; border-radius: 6px; padding: 8px; margin-top: 6px; font-size: 12px; }
  #file-input { display: none; }
  .group-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.75); z-index: 500; align-items: center; justify-content: center; }
  .group-overlay.open { display: flex; }
  .group-box { background: #1a1a1a; border: 1px solid #ff6a00; border-radius: 10px; padding: 24px; width: 340px; }
  .group-box h3 { color: #ff6a00; margin-bottom: 16px; }
  .friend-check-list { max-height: 200px; overflow-y: auto; margin-bottom: 12px; }
  .friend-check-item { display: flex; align-items: center; gap: 8px; padding: 5px 0; font-size: 14px; }
</style>
</head>
<body>
<nav class="navbar">
  <a class="logo" href="/feed">Spacebook</a>
  <div class="nav-links">
    <a href="/feed">Feed</a>
    <a href="/profile">Profile</a>
    <a href="/messages" style="color:#ff6a00">Messages</a>
    <a href="/stories">Stories</a>
    <a href="/gallery">Gallery</a>
    <a href="/logout">Logout</a>
  </div>
</nav>

<div class="msg-layout">
  <div class="conv-list">
    <div class="conv-list-header">
      Messages
      <button class="icon-btn" style="padding:4px 10px;font-size:13px" onclick="openGroupModal()">+ Group</button>
    </div>
    <div id="conv-list-items"></div>
  </div>

  <div class="chat-panel">
    <div class="chat-header" id="chat-header">
      <span style="color:#888;font-weight:400">Select a conversation</span>
    </div>
    <div class="chat-messages" id="chat-messages"></div>
    <div class="typing-bar" id="typing-bar"></div>
    <div class="chat-input-row">
      <button class="icon-btn" id="voice-btn" title="Voice note">ðŸŽ™</button>
      <button class="icon-btn" onclick="document.getElementById('file-input').click()" title="Attach">ðŸ“Ž</button>
      <input type="file" id="file-input" accept="image/*,video/*" onchange="handleFileAttach(event)"/>
      <textarea id="msg-input" placeholder="Type a messageâ€¦ paste a SoundCloud link for a preview" oninput="handleTypingInput()" onkeydown="handleMsgKeydown(event)"></textarea>
      <button class="btn-primary" style="width:auto;padding:10px 18px;flex-shrink:0" onclick="sendTextMessage()">Send</button>
    </div>
  </div>
</div>

<div class="group-overlay" id="group-overlay">
  <div class="group-box">
    <h3>New Group Chat</h3>
    <input type="text" id="group-name-input" placeholder="Group name"/>
    <div class="friend-check-list" id="friend-check-list"></div>
    <button class="btn-primary" onclick="submitGroupCreate()" style="margin-bottom:10px">Create Group</button>
    <br/><a href="#" onclick="closeGroupModal();return false" style="color:#888;font-size:13px">Cancel</a>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="/modules/messaging-client.js"></script>
</body>
</html>
