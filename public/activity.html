<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Spacebook ¬∑ Activity</title>
<link rel="stylesheet" href="/assets/css/styles.css"/>
<style>
  html, body {
    background: #000;
    margin: 0; padding: 0;
    color: #fff;
    font-family: Arial, sans-serif;
    overflow-x: hidden;
  }
  #starfield {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: -1;
    background: #000;
  }
  .navbar {
    width: 100%;
    padding: 14px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(8px);
    box-sizing: border-box;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .navbar .logo { color: #ff6a00; font-size: 20px; font-weight: bold; text-decoration: none; }
  .nav-links { display: flex; flex-wrap: wrap; gap: 10px; }
  .nav-links a { color: #ccc; text-decoration: none; font-size: 13px; }
  .nav-links a:hover, .nav-links a.active { color: #ff6a00; }

  .activity-wrap {
    max-width: 680px;
    margin: 30px auto;
    padding: 0 16px;
    box-sizing: border-box;
  }
  .activity-title {
    color: #ff6a00;
    font-size: 22px;
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .refresh-btn {
    background: rgba(255,106,0,0.15);
    border: 1px solid #ff6a00;
    color: #ff6a00;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    font-weight: bold;
  }
  .refresh-btn:hover { background: rgba(255,106,0,0.3); }

  .filter-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 16px;
  }
  .filter-btn {
    padding: 6px 14px;
    border-radius: 20px;
    border: 1px solid #333;
    background: rgba(0,0,0,0.5);
    color: #aaa;
    cursor: pointer;
    font-size: 13px;
    transition: all .15s;
    backdrop-filter: blur(4px);
  }
  .filter-btn.active {
    background: #ff6a00;
    color: #000;
    border-color: #ff6a00;
    font-weight: 700;
  }

  .activity-list { display: flex; flex-direction: column; gap: 10px; }

  .activity-item {
    background: rgba(0,0,0,0.5);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 14px 16px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    transition: border-color .15s;
    backdrop-filter: blur(8px);
  }
  .activity-item:hover { border-color: #ff6a00; }

  .activity-icon {
    font-size: 20px;
    flex-shrink: 0;
    width: 38px; height: 38px;
    background: rgba(255,106,0,0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255,106,0,0.3);
  }
  .activity-body { flex: 1; min-width: 0; }
  .activity-desc { font-size: 14px; color: #f0f0f0; line-height: 1.5; word-break: break-word; }
  .activity-desc strong { color: #ff6a00; }
  .activity-meta { display: flex; align-items: center; gap: 8px; margin-top: 6px; flex-wrap: wrap; }
  .activity-time { font-size: 11px; color: #666; }
  .activity-type-tag {
    font-size: 11px;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 10px;
  }
  .tag-post { background: rgba(255,106,0,.15); color: #ff6a00; }
  .tag-comment { background: rgba(34,197,94,.12); color: #22c55e; }
  .tag-friend { background: rgba(99,102,241,.15); color: #818cf8; }
  .tag-photo { background: rgba(236,72,153,.12); color: #f472b6; }
  .tag-story { background: rgba(234,179,8,.12); color: #facc15; }
  .tag-playlist { background: rgba(14,165,233,.12); color: #38bdf8; }
  .tag-song { background: rgba(168,85,247,.12); color: #c084fc; }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
    background: rgba(0,0,0,0.4);
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.08);
    backdrop-filter: blur(8px);
  }
  .empty-icon { font-size: 48px; margin-bottom: 12px; }

  .load-more {
    display: block;
    width: 100%;
    margin-top: 16px;
    padding: 12px;
    background: rgba(0,0,0,0.5);
    border: 1px solid rgba(255,106,0,0.4);
    border-radius: 12px;
    color: #ff6a00;
    font-weight: 700;
    cursor: pointer;
    font-size: 14px;
    backdrop-filter: blur(8px);
    box-sizing: border-box;
  }
  .load-more:hover { background: rgba(255,106,0,0.1); }

  /* Mobile */
  @media (max-width: 600px) {
    .navbar { padding: 10px 14px; }
    .nav-links { gap: 8px; }
    .nav-links a { font-size: 12px; }
    .activity-wrap { margin: 16px auto; }
    .activity-title { font-size: 18px; }
    .filter-row { gap: 6px; }
    .filter-btn { padding: 5px 10px; font-size: 12px; }
    .activity-item { padding: 12px; }
    .activity-desc { font-size: 13px; }
  }
</style>
</head>
<body>
<canvas id="starfield"></canvas>
<script>
  const canvas = document.getElementById("starfield");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  window.addEventListener("resize", () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  });
  const stars = Array.from({ length: 200 }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 1.5 + 0.3,
    alpha: Math.random(),
    speed: Math.random() * 0.3 + 0.1
  }));
  const shootingStars = [];
  function spawnShootingStar() {
    shootingStars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height * 0.5,
      len: Math.random() * 120 + 80,
      speed: Math.random() * 8 + 6,
      angle: Math.PI / 4,
      alpha: 1
    });
  }
  setInterval(spawnShootingStar, 2500);
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    stars.forEach(s => {
      s.alpha += s.speed * 0.02 * (Math.random() > 0.5 ? 1 : -1);
      s.alpha = Math.max(0.1, Math.min(1, s.alpha));
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(255,255,255," + s.alpha + ")";
      ctx.fill();
    });
    for (let i = shootingStars.length - 1; i >= 0; i--) {
      const s = shootingStars[i];
      ctx.beginPath();
      ctx.moveTo(s.x, s.y);
      ctx.lineTo(s.x - Math.cos(s.angle) * s.len, s.y - Math.sin(s.angle) * s.len);
      const grad = ctx.createLinearGradient(s.x, s.y, s.x - Math.cos(s.angle) * s.len, s.y - Math.sin(s.angle) * s.len);
      grad.addColorStop(0, "rgba(255,150,50," + s.alpha + ")");
      grad.addColorStop(1, "rgba(255,150,50,0)");
      ctx.strokeStyle = grad;
      ctx.lineWidth = 2;
      ctx.stroke();
      s.x += Math.cos(s.angle) * s.speed;
      s.y += Math.sin(s.angle) * s.speed;
      s.alpha -= 0.015;
      if (s.alpha <= 0) shootingStars.splice(i, 1);
    }
    requestAnimationFrame(draw);
  }
  draw();
</script>

<nav class="navbar">
  <a class="logo" href="/feed">Spacebook</a>
  <div class="nav-links">
    <a href="/home">Home</a>
    <a href="/feed">Feed</a>
    <a href="/profile">Profile</a>
    <a href="/messages">Messages</a>
    <a href="/stories">Stories</a>
    <a href="/gallery">Gallery</a>
    <a href="/activity" class="active">Activity</a>
    <a href="/logout">Logout</a>
  </div>
</nav>

<div class="activity-wrap">
  <div class="activity-title">
    <span>üåå Activity</span>
    <button class="refresh-btn" onclick="loadActivity()">‚Üª Refresh</button>
  </div>

  <div class="filter-row">
    <button class="filter-btn active" onclick="setFilter('all',this)">All</button>
    <button class="filter-btn" onclick="setFilter('post',this)">Posts</button>
    <button class="filter-btn" onclick="setFilter('photo',this)">Photos</button>
    <button class="filter-btn" onclick="setFilter('friend',this)">Friends</button>
    <button class="filter-btn" onclick="setFilter('story',this)">Stories</button>
    <button class="filter-btn" onclick="setFilter('playlist',this)">Playlists</button>
    <button class="filter-btn" onclick="setFilter('song',this)">Songs</button>
  </div>

  <div id="activity-list" class="activity-list">
    <div class="empty-state">
      <div class="empty-icon">üåå</div>
      <div>Loading your universe...</div>
    </div>
  </div>
  <button class="load-more" id="load-more-btn" onclick="loadMore()" style="display:none">Load More</button>
</div>

<script>
  const ICONS = {
    post: 'üìù', comment: 'üí¨', friend: 'ü§ù',
    photo: 'üì∑', story: '‚ö°', playlist: 'üéµ', song: 'üéß'
  };

  let allActivity = [];
  let currentFilter = 'all';
  let visibleCount = 20;

  async function loadActivity() {
    document.getElementById('activity-list').innerHTML = '<div class="empty-state"><div class="empty-icon">üåå</div><div>Loading...</div></div>';
    const data = await fetch('/api/activity-feed', { credentials: 'include' }).then(r => r.json()).catch(() => []);
    allActivity = data;
    visibleCount = 20;
    renderActivity();
  }

  function setFilter(type, btn) {
    currentFilter = type;
    visibleCount = 20;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderActivity();
  }

  function loadMore() {
    visibleCount += 20;
    renderActivity();
  }

  function timeAgo(date) {
    const diff = Date.now() - new Date(date).getTime();
    const mins = Math.floor(diff / 60000);
    if (mins < 1) return 'just now';
    if (mins < 60) return mins + 'm ago';
    const hrs = Math.floor(mins / 60);
    if (hrs < 24) return hrs + 'h ago';
    const days = Math.floor(hrs / 24);
    if (days < 7) return days + 'd ago';
    return new Date(date).toLocaleDateString();
  }

  function renderActivity() {
    const list = document.getElementById('activity-list');
    const filtered = currentFilter === 'all'
      ? allActivity
      : allActivity.filter(a => a.type === currentFilter);

    if (!filtered.length) {
      list.innerHTML = '<div class="empty-state"><div class="empty-icon">üåå</div><div>No activity yet. Start connecting!</div></div>';
      document.getElementById('load-more-btn').style.display = 'none';
      return;
    }

    const visible = filtered.slice(0, visibleCount);
    list.innerHTML = visible.map(function(a) {
      return '<div class="activity-item">' +
        '<div class="activity-icon">' + (ICONS[a.type] || '‚ö°') + '</div>' +
        '<div class="activity-body">' +
          '<div class="activity-desc">' + (a.description || 'Activity') + '</div>' +
          '<div class="activity-meta">' +
            '<span class="activity-type-tag tag-' + a.type + '">' + a.type + '</span>' +
            '<span class="activity-time">' + timeAgo(a.createdAt) + '</span>' +
          '</div>' +
        '</div>' +
      '</div>';
    }).join('');

    document.getElementById('load-more-btn').style.display = filtered.length > visibleCount ? 'block' : 'none';
  }

  loadActivity();
</script>
</body>
</html>
