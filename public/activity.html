<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Spacebook Â· Activity</title>
<link rel="stylesheet" href="/styles.css"/>
<style>
  .activity-page { max-width: 700px; margin: 30px auto; padding: 0 16px; }
  .activity-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .activity-header h2 { color: #ff6a00; }
  .filter-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
  .filter-btn { padding: 6px 14px; border-radius: 20px; border: 1px solid #333; background: #0d0d0d; color: #aaa; cursor: pointer; font-size: 13px; transition: all .15s; }
  .filter-btn.active { background: #ff6a00; color: #000; border-color: #ff6a00; font-weight: 700; }
  .activity-list { display: flex; flex-direction: column; gap: 10px; }
  .activity-item { background: #1a1a1a; border: 1px solid #222; border-radius: 8px; padding: 14px 16px; display: flex; align-items: flex-start; gap: 12px; transition: border-color .15s; }
  .activity-item:hover { border-color: #ff6a00; }
  .activity-icon { font-size: 22px; flex-shrink: 0; width: 36px; height: 36px; background: #0d0d0d; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid #333; }
  .activity-body { flex: 1; min-width: 0; }
  .activity-desc { font-size: 14px; color: #f2f2f2; line-height: 1.5; }
  .activity-time { font-size: 11px; color: #666; margin-top: 4px; }
  .activity-type-tag { font-size: 11px; font-weight: 700; padding: 2px 8px; border-radius: 10px; display: inline-block; margin-top: 4px; }
  .tag-post { background: rgba(255,106,0,.15); color: #ff6a00; }
  .tag-comment { background: rgba(34,197,94,.12); color: #22c55e; }
  .tag-friend { background: rgba(99,102,241,.15); color: #818cf8; }
  .tag-photo { background: rgba(236,72,153,.12); color: #f472b6; }
  .tag-story { background: rgba(234,179,8,.12); color: #facc15; }
  .tag-playlist { background: rgba(14,165,233,.12); color: #38bdf8; }
  .tag-song { background: rgba(168,85,247,.12); color: #c084fc; }
  .empty-state { text-align: center; padding: 60px 20px; color: #888; }
  .empty-state .empty-icon { font-size: 48px; margin-bottom: 12px; }
  .load-more { display: block; width: 100%; margin-top: 16px; padding: 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; color: #ff6a00; font-weight: 700; cursor: pointer; text-align: center; font-size: 14px; }
  .load-more:hover { background: #222; }
</style>
</head>
<body>
<nav class="navbar">
  <a class="logo" href="/feed">Spacebook</a>
  <div class="nav-links">
    <a href="/feed">Feed</a>
    <a href="/profile">Profile</a>
    <a href="/messages">Messages</a>
    <a href="/stories">Stories</a>
    <a href="/gallery">Gallery</a>
    <a href="/activity" style="color:#ff6a00">Activity</a>
    <a href="/logout">Logout</a>
  </div>
</nav>

<div class="activity-page">
  <div class="activity-header">
    <h2>Activity Feed</h2>
    <button class="btn-secondary" style="padding:6px 14px;font-size:13px" onclick="loadActivity()">â†» Refresh</button>
  </div>

  <div class="filter-row">
    <button class="filter-btn active" onclick="setFilter('all',this)">All</button>
    <button class="filter-btn" onclick="setFilter('post',this)">Posts</button>
    <button class="filter-btn" onclick="setFilter('comment',this)">Comments</button>
    <button class="filter-btn" onclick="setFilter('friend',this)">Friends</button>
    <button class="filter-btn" onclick="setFilter('photo',this)">Photos</button>
    <button class="filter-btn" onclick="setFilter('story',this)">Stories</button>
    <button class="filter-btn" onclick="setFilter('playlist',this)">Playlists</button>
    <button class="filter-btn" onclick="setFilter('song',this)">Songs</button>
  </div>

  <div id="activity-list" class="activity-list"></div>
  <button class="load-more" id="load-more-btn" onclick="loadMore()" style="display:none">Load More</button>
</div>

<script>
  const ICONS = {
    post: 'ðŸ“', comment: 'ðŸ’¬', friend: 'ðŸ¤',
    photo: 'ðŸ“·', story: 'âš¡', playlist: 'ðŸŽµ', song: 'ðŸŽ§'
  };

  let allActivity = [];
  let currentFilter = 'all';
  let visibleCount = 20;

  async function loadActivity() {
    const data = await fetch('/api/activity-feed', { credentials: 'include' }).then(r => r.json()).catch(() => []);
    allActivity = data;
    visibleCount = 20;
    renderActivity();
  }

  function setFilter(type, btn) {
    currentFilter = type;
    visibleCount = 20;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderActivity();
  }

  function loadMore() {
    visibleCount += 20;
    renderActivity();
  }

  function timeAgo(date) {
    const diff = Date.now() - new Date(date).getTime();
    const mins = Math.floor(diff / 60000);
    if (mins < 1) return 'just now';
    if (mins < 60) return `${mins}m ago`;
    const hrs = Math.floor(mins / 60);
    if (hrs < 24) return `${hrs}h ago`;
    const days = Math.floor(hrs / 24);
    if (days < 7) return `${days}d ago`;
    return new Date(date).toLocaleDateString();
  }

  function renderActivity() {
    const list = document.getElementById('activity-list');
    const filtered = currentFilter === 'all'
      ? allActivity
      : allActivity.filter(a => a.type === currentFilter);

    if (!filtered.length) {
      list.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ðŸŒŒ</div>
          <div>No activity yet. Start connecting!</div>
        </div>`;
      document.getElementById('load-more-btn').style.display = 'none';
      return;
    }

    const visible = filtered.slice(0, visibleCount);
    list.innerHTML = visible.map(a => `
      <div class="activity-item">
        <div class="activity-icon">${ICONS[a.type] || 'âš¡'}</div>
        <div class="activity-body">
          <div class="activity-desc">${a.description || 'Activity'}</div>
          <div>
            <span class="activity-type-tag tag-${a.type}">${a.type}</span>
          </div>
          <div class="activity-time">${timeAgo(a.createdAt)}</div>
        </div>
      </div>`).join('');

    const loadMoreBtn = document.getElementById('load-more-btn');
    loadMoreBtn.style.display = filtered.length > visibleCount ? 'block' : 'none';
  }

  loadActivity();
</script>
</body>
</html>
